<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="code_mirror/lib/codemirror.css">
        <link rel="stylesheet" href="base16-dark.css">
        <script src="code_mirror/lib/codemirror.js"></script>
        <script src="code_mirror/mode/javascript/javascript.js"></script>
        <script src="code_mirror/mode/python/python.js"></script>
        <script src="code_mirror/mode/clike/clike.js"></script>
        <script src="code_mirror/edit/closebrackets.js"></script>
        <script src="code_mirror/keymap/vim.js"></script>
        <script src="code_mirror/keymap/emacs.js"></script>
    </head>
    <script>
        var charCounter = null;
        var timer = null;
        var startTime = 0;
        var endTime = 0;
        var timerRunning = false;
        var hasStarted = false;
        var editor = null;

        function init() {
            var pythonDefault = "def sumEven(n):";
            var cDefault = "long sumEven(long n)\n{\n}";
            var javaDefault = "public long sumEven(long n) {\n}";

            editor = CodeMirror(document.getElementById('editor'), {
                value:pythonDefault,
                smartIndent:true,
                theme:"base16-dark",
                indentUnit:4,
                indenWithTabs:false,
                electricChars:true,
                lineNumbers:true,
                keyMap:"vim",
                autofocus:true,
                autoCloseBrackets:true,
                mode:"python"
            });

            editor.save = function () {
                endTime = new Date();
                timerRunning = false;
            };

            charCounter = document.getElementById('char_counter');
            timer = document.getElementById('timer');

            editor.on("change", function () {
                if (!hasStarted) {
                    hasStarted = true;
                    timerRunning = true;
                    startTime = new Date();
                }
            });

            editor.on("change", updateCharCount);
            window.setInterval(updateTimer, 10);

            updateCharCount();
            updateTimer();
        }

        function updateCharCount() {
            charCounter.innerHTML = editor.getValue().replace(/\s/g, '').length;
        }

        function updateTimer() {
            var end = endTime;

            if (timerRunning) {
                end = new Date();
            }

            var elapsed = (end - startTime) / 1000;
            var remaining = Math.round(100*(60 - elapsed))/100;

            timer.innerHTML = remaining + (Math.round(remaining) ==
            remaining ? '.0' : '') + (Math.round(remaining*10)/10 ==
            remaining ? '0' : '') + 's';
        }
    </script>
    <body onload="init()">
        <div class="big_box wide" style="height: 438px;">
            <div id="timer">00:00</div>
            <div id="char_counter">0</div>
            <div style="clear: both;"></div>
            <div id="editor"></div>
            <div class="button wide">Submit</div>
            <div style="margin-left: auto; margin-right: auto; display: inline-block;">
                <div style="width: 135px; float: left; margin-left: 5px; margin-right: 5px;">
                    <h3>Info</h3>
                    <div class="info" style="font-size: 14px; height: 86px;
                        vertical-align: middle; line-height: 19px;">
                        <i>sumEven</i> should return the sum of all positive <i>even</i> integers
                        less than <i>n</i>.
                    </div>
                </div>
                <div style="width: 135px; float: left; margin-left: 5px; margin-right: 5px;">
                    <h3>Setup</h3>
                    <div class="info_part top" style="text-align: center;">
                        martinvl
                    </div>
                    <div class="info_part middle" style="text-align: center;">
                        Java
                    </div>
                    <div class="info_part bottom" style="text-align: center;">
                        Vim
                    </div>
                </div>
                <div style="float: left; margin-left: 5px; margin-right: 5px;">
                    <h3>Status</h3>
                    <div class="info_part top">
                        <div class="status_light green"></div>Submission
                    </div>
                    <div class="info_part middle">
                        <div class="status_light yellow"></div>Compilation
                    </div>
                    <div class="info_part bottom">
                        <div class="status_light red"></div>Testing
                    </div>
                </div>
                <div style="clear: both;"></div>
            </div>
        </div>
    </body>
</html>
